{% extends 'base.html' %}
{% load static %}

{% block title %}Demonstra√ß√£o das Melhorias - Sistema de Upload de Mang√°s{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'mangas/css/enhanced-upload.css' %}">
<style>
.demo-section {
    margin: 2rem 0;
    padding: 2rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #f9f9f9;
}

.demo-header {
    color: #2c3e50;
    border-bottom: 2px solid #3498db;
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
}

.feature-list {
    list-style: none;
    padding: 0;
}

.feature-list li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
}

.feature-list li:before {
    content: "‚úì";
    color: #27ae60;
    font-weight: bold;
    margin-right: 0.5rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin: 1rem 0;
}

.stat-card {
    background: white;
    padding: 1rem;
    border-radius: 6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    text-align: center;
}

.stat-number {
    font-size: 2rem;
    font-weight: bold;
    color: #3498db;
}

.stat-label {
    color: #7f8c8d;
    font-size: 0.9rem;
}

.demo-upload-area {
    border: 2px dashed #bdc3c7;
    border-radius: 8px;
    padding: 2rem;
    text-align: center;
    background: white;
    margin: 1rem 0;
}

.quality-indicator {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: bold;
}

.quality-excellent { background: #d4edda; color: #155724; }
.quality-good { background: #d1ecf1; color: #0c5460; }
.quality-fair { background: #fff3cd; color: #856404; }
.quality-poor { background: #f8d7da; color: #721c24; }

.progress-demo {
    background: #ecf0f1;
    border-radius: 4px;
    height: 20px;
    overflow: hidden;
    margin: 0.5rem 0;
}

.progress-bar-demo {
    background: linear-gradient(90deg, #3498db, #2980b9);
    height: 100%;
    transition: width 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.8rem;
}

.btn-demo {
    background: #3498db;
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 4px;
    cursor: pointer;
    margin: 0.25rem;
    transition: background 0.3s ease;
}

.btn-demo:hover {
    background: #2980b9;
}

.btn-demo:disabled {
    background: #bdc3c7;
    cursor: not-allowed;
}

.log-area {
    background: #2c3e50;
    color: #ecf0f1;
    padding: 1rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    height: 200px;
    overflow-y: auto;
    margin: 1rem 0;
}

.api-endpoint {
    background: #34495e;
    color: #ecf0f1;
    padding: 0.5rem;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    margin: 0.5rem 0;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <h1 class="text-center mb-4">üöÄ Demonstra√ß√£o das Melhorias Implementadas</h1>
            <p class="text-center text-muted mb-5">
                Sistema de Upload de Mang√°s com Processamento em Lote, Interface Aprimorada e Sistema de Qualidade
            </p>
        </div>
    </div>

    <!-- Melhoria 3: Processamento em Lote -->
    <div class="demo-section">
        <h2 class="demo-header">üì¶ Melhoria 3: Processamento em Lote Aprimorado</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>Funcionalidades Implementadas:</h4>
                <ul class="feature-list">
                    <li>Sess√µes de upload com controle de estado</li>
                    <li>Valida√ß√£o pr√©via de arquivos em lote</li>
                    <li>Processamento ass√≠ncrono com filas</li>
                    <li>Limites aprimorados: 20MB/arquivo, 200MB/sess√£o</li>
                    <li>Suporte para at√© 500 arquivos por sess√£o</li>
                    <li>Recupera√ß√£o autom√°tica de falhas</li>
                    <li>Monitoramento de progresso em tempo real</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h4>Estat√≠sticas do Sistema:</h4>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-sessions">0</div>
                        <div class="stat-label">Sess√µes Ativas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="total-files">0</div>
                        <div class="stat-label">Arquivos Processados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="success-rate">0%</div>
                        <div class="stat-label">Taxa de Sucesso</div>
                    </div>
                </div>
            </div>
        </div>

        <h4>APIs Dispon√≠veis:</h4>
        <div class="api-endpoint">POST /api/upload/session/ - Criar sess√£o de upload</div>
        <div class="api-endpoint">GET /api/upload/session/{id}/ - Obter status da sess√£o</div>
        <div class="api-endpoint">POST /api/upload/validate/ - Valida√ß√£o pr√©via de arquivos</div>
        <div class="api-endpoint">GET /api/upload/stats/ - Estat√≠sticas do usu√°rio</div>
    </div>

    <!-- Melhoria 5: Interface de Upload Aprimorada -->
    <div class="demo-section">
        <h2 class="demo-header">üé® Melhoria 5: Interface de Upload Aprimorada</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>Funcionalidades da Interface:</h4>
                <ul class="feature-list">
                    <li>Drag & Drop avan√ßado com preview</li>
                    <li>Valida√ß√£o instant√¢nea de arquivos</li>
                    <li>Upload resum√≠vel com chunks</li>
                    <li>Barra de progresso detalhada</li>
                    <li>Gerenciamento visual de arquivos</li>
                    <li>Feedback em tempo real</li>
                    <li>Interface responsiva e moderna</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h4>Demonstra√ß√£o da Interface:</h4>
                <div class="demo-upload-area" id="demo-drop-zone">
                    <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                    <p>Arraste arquivos aqui ou clique para selecionar</p>
                    <p class="text-muted">Suporte: JPG, PNG, WebP, GIF (m√°x. 20MB)</p>
                    <input type="file" id="demo-file-input" multiple accept="image/*" style="display: none;">
                </div>
                
                <div id="demo-file-list" class="mt-3"></div>
                
                <div class="progress-demo">
                    <div class="progress-bar-demo" id="demo-progress" style="width: 0%">0%</div>
                </div>
            </div>
        </div>

        <h4>Controles de Demonstra√ß√£o:</h4>
        <button class="btn-demo" onclick="simulateUpload()">Simular Upload</button>
        <button class="btn-demo" onclick="simulateValidation()">Simular Valida√ß√£o</button>
        <button class="btn-demo" onclick="simulateError()">Simular Erro</button>
        <button class="btn-demo" onclick="clearDemo()">Limpar</button>

        <h4>APIs de Upload Resum√≠vel:</h4>
        <div class="api-endpoint">POST /api/resumable/session/ - Criar sess√£o resum√≠vel</div>
        <div class="api-endpoint">POST /api/resumable/chunk/ - Upload de chunk</div>
        <div class="api-endpoint">POST /api/resumable/session/{id}/finalize/ - Finalizar upload</div>
        <div class="api-endpoint">GET /api/resumable/session/{id}/chunks/ - Verificar chunks</div>
    </div>

    <!-- Melhoria 6: Sistema de Qualidade -->
    <div class="demo-section">
        <h2 class="demo-header">‚≠ê Melhoria 6: Sistema de Qualidade</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>An√°lise de Qualidade:</h4>
                <ul class="feature-list">
                    <li>An√°lise autom√°tica de resolu√ß√£o</li>
                    <li>Detec√ß√£o de compress√£o excessiva</li>
                    <li>Verifica√ß√£o de nitidez e contraste</li>
                    <li>Detec√ß√£o de artefatos JPEG</li>
                    <li>An√°lise de propor√ß√£o e dimens√µes</li>
                    <li>Score de qualidade geral (0-100)</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h4>Detec√ß√£o de Duplicatas:</h4>
                <ul class="feature-list">
                    <li>Hash perceptual para compara√ß√£o</li>
                    <li>Detec√ß√£o de imagens similares</li>
                    <li>An√°lise de histograma de cores</li>
                    <li>Verifica√ß√£o de dimens√µes id√™nticas</li>
                    <li>Relat√≥rio de duplicatas encontradas</li>
                </ul>
            </div>
        </div>

        <h4>Demonstra√ß√£o de An√°lise de Qualidade:</h4>
        <div class="row">
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="quality-indicator quality-excellent">Excelente</div>
                    <div class="stat-number">95</div>
                    <div class="stat-label">Score de Qualidade</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="quality-indicator quality-good">Boa</div>
                    <div class="stat-number">78</div>
                    <div class="stat-label">Score de Qualidade</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="quality-indicator quality-fair">Regular</div>
                    <div class="stat-number">62</div>
                    <div class="stat-label">Score de Qualidade</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stat-card">
                    <div class="quality-indicator quality-poor">Ruim</div>
                    <div class="stat-number">34</div>
                    <div class="stat-label">Score de Qualidade</div>
                </div>
            </div>
        </div>

        <h4>API de An√°lise de Qualidade:</h4>
        <div class="api-endpoint">POST /api/upload/quality/ - An√°lise de qualidade e duplicatas</div>
    </div>

    <!-- Log de Atividades -->
    <div class="demo-section">
        <h2 class="demo-header">üìã Log de Atividades</h2>
        <div class="log-area" id="activity-log">
            [INFO] Sistema de demonstra√ß√£o inicializado<br>
            [INFO] Aguardando intera√ß√£o do usu√°rio...<br>
        </div>
    </div>

    <!-- Links para Funcionalidades -->
    <div class="demo-section">
        <h2 class="demo-header">üîó Acesso √†s Funcionalidades</h2>
        <div class="row">
            <div class="col-md-4">
                <div class="stat-card">
                    <h5>Upload Tradicional</h5>
                    <p>Interface original do sistema</p>
                    <a href="{% url 'mangas:capitulo_complete_create' %}" class="btn-demo">Acessar</a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <h5>Upload Aprimorado</h5>
                    <p>Nova interface com todas as melhorias</p>
                    <a href="{% url 'mangas:enhanced_upload' %}" class="btn-demo">Acessar</a>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <h5>Upload de Volume</h5>
                    <p>Upload de volumes compactados</p>
                    <a href="{% url 'mangas:volume_upload' %}" class="btn-demo">Acessar</a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'mangas/js/enhanced-upload.js' %}"></script>
<script src="{% static 'mangas/js/resumable-upload.js' %}"></script>
<script>
// Simula√ß√£o de funcionalidades para demonstra√ß√£o
let demoProgress = 0;
let demoInterval;

// Configura√ß√£o do drag & drop de demonstra√ß√£o
document.addEventListener('DOMContentLoaded', function() {
    const dropZone = document.getElementById('demo-drop-zone');
    const fileInput = document.getElementById('demo-file-input');
    
    dropZone.addEventListener('click', () => fileInput.click());
    
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#3498db';
        dropZone.style.backgroundColor = '#f8f9fa';
    });
    
    dropZone.addEventListener('dragleave', () => {
        dropZone.style.borderColor = '#bdc3c7';
        dropZone.style.backgroundColor = 'white';
    });
    
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.borderColor = '#bdc3c7';
        dropZone.style.backgroundColor = 'white';
        
        const files = Array.from(e.dataTransfer.files);
        displayDemoFiles(files);
    });
    
    fileInput.addEventListener('change', (e) => {
        const files = Array.from(e.target.files);
        displayDemoFiles(files);
    });
    
    // Atualiza estat√≠sticas periodicamente
    updateStats();
    setInterval(updateStats, 5000);
});

function displayDemoFiles(files) {
    const fileList = document.getElementById('demo-file-list');
    fileList.innerHTML = '';
    
    files.forEach((file, index) => {
        const fileDiv = document.createElement('div');
        fileDiv.className = 'alert alert-info';
        fileDiv.innerHTML = `
            <strong>${file.name}</strong> (${formatBytes(file.size)})
            <span class="quality-indicator quality-good float-right">Validado</span>
        `;
        fileList.appendChild(fileDiv);
    });
    
    logActivity(`[INFO] ${files.length} arquivo(s) selecionado(s) para demonstra√ß√£o`);
}

function simulateUpload() {
    demoProgress = 0;
    const progressBar = document.getElementById('demo-progress');
    
    logActivity('[INFO] Iniciando simula√ß√£o de upload...');
    
    demoInterval = setInterval(() => {
        demoProgress += Math.random() * 15;
        if (demoProgress > 100) demoProgress = 100;
        
        progressBar.style.width = demoProgress + '%';
        progressBar.textContent = Math.round(demoProgress) + '%';
        
        if (demoProgress >= 100) {
            clearInterval(demoInterval);
            logActivity('[SUCCESS] Upload simulado conclu√≠do com sucesso!');
        }
    }, 200);
}

function simulateValidation() {
    logActivity('[INFO] Executando valida√ß√£o de arquivos...');
    
    setTimeout(() => {
        logActivity('[SUCCESS] Valida√ß√£o conclu√≠da: 3 arquivos v√°lidos, 0 inv√°lidos');
        logActivity('[INFO] An√°lise de qualidade: Score m√©dio 87/100');
    }, 1500);
}

function simulateError() {
    logActivity('[ERROR] Simula√ß√£o de erro: Arquivo muito grande (25MB > 20MB)');
    logActivity('[INFO] Upload cancelado automaticamente');
}

function clearDemo() {
    document.getElementById('demo-file-list').innerHTML = '';
    document.getElementById('demo-progress').style.width = '0%';
    document.getElementById('demo-progress').textContent = '0%';
    document.getElementById('demo-file-input').value = '';
    
    if (demoInterval) {
        clearInterval(demoInterval);
    }
    
    logActivity('[INFO] Demonstra√ß√£o limpa');
}

function updateStats() {
    // Simula estat√≠sticas din√¢micas
    document.getElementById('total-sessions').textContent = Math.floor(Math.random() * 10) + 1;
    document.getElementById('total-files').textContent = Math.floor(Math.random() * 1000) + 500;
    document.getElementById('success-rate').textContent = (95 + Math.random() * 4).toFixed(1) + '%';
}

function logActivity(message) {
    const log = document.getElementById('activity-log');
    const timestamp = new Date().toLocaleTimeString();
    log.innerHTML += `[${timestamp}] ${message}<br>`;
    log.scrollTop = log.scrollHeight;
}

function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}
</script>
{% endblock %}