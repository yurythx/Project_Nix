{% extends 'config/base_config.html' %}
{% load config_extras %}

{% block config_title %}Dashboard{% endblock %}
{% block page_icon %}<i class="fas fa-tachometer-alt me-2"></i>{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block config_content %}
<div class="config-dashboard">
    <!-- Header da Página -->
    <div class="config-page-header">
        <h1 class="config-page-title">
            <i class="fas fa-tachometer-alt config-page-icon" aria-hidden="true"></i>
            Dashboard
        </h1>
        <p class="config-page-subtitle">Visão geral do sistema e estatísticas principais</p>
    </div>
    <!-- Cards de Estatísticas -->
    <div class="config-stats-grid">
        {% get_config_stats as stats %}
        
        <!-- Usuários -->
        <div class="config-stat-card config-stat-primary">
            {% include 'config/includes/_stat_card.html' with label='Usuários' value=stats.total_users icon='fas fa-users' color='primary' %}
        </div>
        
        <!-- Módulos Ativos -->
        <div class="config-stat-card config-stat-success">
            {% include 'config/includes/_stat_card.html' with label='Módulos Ativos' value=stats.active_modules icon='fas fa-cubes' color='success' %}
        </div>
        
        <!-- Emails Enviados -->
        <div class="config-stat-card config-stat-info">
            {% include 'config/includes/_stat_card.html' with label='Emails Enviados' value=stats.emails_sent|default:"0" icon='fas fa-envelope' color='info' %}
        </div>
        
        <!-- Grupos -->
        <div class="config-stat-card config-stat-warning">
            {% include 'config/includes/_stat_card.html' with label='Grupos' value=stats.total_groups icon='fas fa-layer-group' color='warning' %}
        </div>
    </div>

    <!-- Conteúdo Principal -->
    <div class="config-main-content">
        <!-- Status do Sistema -->
        <div class="config-system-status">
            <div class="config-status-card">
                <div class="config-status-header">
                    <h5 class="config-status-title">
                        <i class="fas fa-server config-status-icon" aria-hidden="true"></i>
                        Status do Sistema
                    </h5>
                </div>
                <div class="config-status-body">
                    <div class="config-status-grid">
                        <div class="config-status-item">
                            <div class="config-status-indicator config-status-success">
                                <i class="fas fa-check" aria-hidden="true"></i>
                            </div>
                            <div class="config-status-info">
                                <div class="config-status-label">Sistema Operacional</div>
                                <div class="config-status-value">{{ system_info.os|default:"Desconhecido" }}</div>
                            </div>
                        </div>
                        
                        <div class="config-status-item">
                            <div class="config-status-indicator config-status-info">
                                <i class="fas fa-code" aria-hidden="true"></i>
                            </div>
                            <div class="config-status-info">
                                <div class="config-status-label">Versão Python</div>
                                <div class="config-status-value">{{ system_info.python_version|default:"Desconhecida" }}</div>
                            </div>
                        </div>
                        
                        <div class="config-status-item">
                            <div class="config-status-indicator config-status-warning">
                                <i class="fas fa-database" aria-hidden="true"></i>
                            </div>
                            <div class="config-status-info">
                                <div class="config-status-label">Banco de Dados</div>
                                <div class="config-status-value">{{ system_info.database|default:"Desconhecido" }}</div>
                            </div>
                        </div>
                        
                        <div class="config-status-item">
                            <div class="config-status-indicator config-status-primary">
                                <i class="fas fa-envelope" aria-hidden="true"></i>
                            </div>
                            <div class="config-status-info">
                                <div class="config-status-label">Email</div>
                                <div class="config-status-value">
                                    {% if email_config %}
                                        <span class="config-status-online">Configurado</span>
                                    {% else %}
                                        <span class="config-status-offline">Não configurado</span>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ações Rápidas -->
        <div class="config-quick-actions">
            <div class="config-actions-card">
                <div class="config-actions-header">
                    <h5 class="config-actions-title">
                        <i class="fas fa-bolt config-actions-icon" aria-hidden="true"></i>
                        Ações Rápidas
                    </h5>
                </div>
                <div class="config-actions-body">
                    <div class="config-actions-grid">
                        <a href="{% url 'config:user_list' %}" class="config-action-btn config-action-primary">
                            <i class="fas fa-users" aria-hidden="true"></i>
                            <span>Gerenciar Usuários</span>
                        </a>
                        <a href="{% url 'config:module_list' %}" class="config-action-btn config-action-success">
                            <i class="fas fa-cubes" aria-hidden="true"></i>
                            <span>Gerenciar Módulos</span>
                        </a>
                        <a href="{% url 'config:email_config' %}" class="config-action-btn config-action-info">
                            <i class="fas fa-envelope" aria-hidden="true"></i>
                            <span>Configurar Email</span>
                        </a>
                        <a href="{% url 'config:group_list' %}" class="config-action-btn config-action-warning">
                            <i class="fas fa-layer-group" aria-hidden="true"></i>
                            <span>Gerenciar Grupos</span>
                        </a>
                        <a href="{% url 'config:backup_list' %}" class="config-action-btn config-action-primary">
                            <i class="fas fa-database" aria-hidden="true"></i>
                            <span>Sistema de Backup</span>
                        </a>
                        {% comment %}
                        <!-- Ações legadas removidas - usar apenas backup_list -->
                        <a href="{% url 'config:backup_database' %}" class="config-action-btn config-action-secondary">
                            <i class="fas fa-database" aria-hidden="true"></i>
                            <span>Backup do Banco de Dados</span>
                        </a>
                        <a href="{% url 'config:restore_database' %}" class="config-action-btn config-action-danger">
                            <i class="fas fa-database" aria-hidden="true"></i>
                            <span>Restaurar Banco de Dados</span>
                        </a>
                        <a href="{% url 'config:restore_media' %}" class="config-action-btn config-action-danger">
                            <i class="fas fa-folder-open" aria-hidden="true"></i>
                            <span>Restaurar Mídia</span>
                        </a>
                        {% endcomment %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Módulos do Sistema -->
    <div class="config-modules-section">
        <div class="config-modules-card">
            <div class="config-modules-header">
                <h5 class="config-modules-title">
                    <i class="fas fa-cubes config-modules-icon" aria-hidden="true"></i>
                    Módulos do Sistema
                </h5>
            </div>
            <div class="config-modules-body">
                <div class="config-modules-table">
                    <div class="config-table-responsive">
                        <table class="config-table">
                            <thead class="config-table-header">
                                <tr>
                                    <th scope="col"><i class="fas fa-cube" aria-hidden="true"></i> Módulo</th>
                                    <th scope="col"><i class="fas fa-align-left" aria-hidden="true"></i> Descrição</th>
                                    <th scope="col"><i class="fas fa-toggle-on" aria-hidden="true"></i> Status</th>
                                    <th scope="col"><i class="fas fa-cogs" aria-hidden="true"></i> Ações</th>
                                </tr>
                            </thead>
                            <tbody class="config-table-body">
                            {% for module in recent_modules %}
                                <tr class="config-table-row{% if module.is_core %} config-table-row-core{% endif %}">
                                    <td class="config-table-cell">
                                        <span class="config-module-name">{{ module.display_name }}</span>
                                        {% if module.is_core %}
                                            <span class="config-badge config-badge-core" title="Módulo essencial">
                                                <i class="fas fa-star" aria-hidden="true"></i> Core
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="config-table-cell">{{ module.description|default:'—' }}</td>
                                    <td class="config-table-cell">
                                        {% if module.is_enabled %}
                                            <span class="config-badge config-badge-success">
                                                <i class="fas fa-check-circle" aria-hidden="true"></i> Ativo
                                            </span>
                                        {% else %}
                                            <span class="config-badge config-badge-secondary">
                                                <i class="fas fa-times-circle" aria-hidden="true"></i> Inativo
                                            </span>
                                        {% endif %}
                                    </td>
                                    <td class="config-table-cell">
                                        <a href="{% url 'config:module_detail' module.app_name %}" class="config-btn config-btn-info config-btn-sm" title="Detalhes">
                                            <i class="fas fa-info-circle" aria-hidden="true"></i>
                                        </a>
                                    </td>
                                </tr>
                            {% empty %}
                                <tr class="config-table-row">
                                    <td colspan="4" class="config-table-cell config-table-empty">
                                        Nenhum módulo encontrado.
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Layout responsivo para mobile -->
                    <div class="config-modules-mobile">
                        {% for module in recent_modules %}
                        <div class="config-module-card{% if module.is_core %} config-module-card-core{% endif %}">
                            <div class="config-module-header">
                                <span class="config-module-name">{{ module.display_name }}</span>
                                {% if module.is_core %}
                                    <span class="config-badge config-badge-core" title="Módulo essencial">
                                        <i class="fas fa-star" aria-hidden="true"></i> Core
                                    </span>
                                {% endif %}
                            </div>
                            <div class="config-module-description">{{ module.description|default:'—' }}</div>
                            <div class="config-module-status">
                                {% if module.is_enabled %}
                                    <span class="config-badge config-badge-success">
                                        <i class="fas fa-check-circle" aria-hidden="true"></i> Ativo
                                    </span>
                                {% else %}
                                    <span class="config-badge config-badge-secondary">
                                        <i class="fas fa-times-circle" aria-hidden="true"></i> Inativo
                                    </span>
                                {% endif %}
                            </div>
                            <div class="config-module-actions">
                                <a href="{% url 'config:module_detail' module.app_name %}" class="config-btn config-btn-info config-btn-sm" title="Detalhes">
                                    <i class="fas fa-info-circle" aria-hidden="true"></i> Ver Detalhes
                                </a>
                            </div>
                        </div>
                        {% empty %}
                        <div class="config-modules-empty">
                            Nenhum módulo encontrado.
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}