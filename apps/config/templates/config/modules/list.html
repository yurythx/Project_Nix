{% extends 'config/base_config.html' %}
{% load config_extras %}

{% block page_title %}Módulos{% endblock %}
{% block page_icon %}fas fa-cubes{% endblock %}

{% block config_content %}
<div class="config-page">
    <!-- Cabeçalho da Página -->
    <div class="config-page-header">
        <div class="config-page-title-section">
            <h1 class="config-page-title">
                <i class="fas fa-cubes config-page-icon" aria-hidden="true"></i>
                Gerenciar Módulos
            </h1>
            <p class="config-page-subtitle">Configurar e gerenciar módulos do sistema</p>
        </div>
    </div>
    
    <!-- Conteúdo da Página -->
    <div class="config-page-content">
        <div class="config-table-card">
            <!-- Tabela para desktop -->
            <div class="config-table-responsive">
                <table class="config-table">
                    <thead class="config-table-header">
                        <tr>
                            <th scope="col"><i class="fas fa-cube" aria-hidden="true"></i> Nome</th>
                            <th scope="col"><i class="fas fa-align-left" aria-hidden="true"></i> Descrição</th>
                            <th scope="col"><i class="fas fa-toggle-on" aria-hidden="true"></i> Ativo</th>
                            <th scope="col"><i class="fas fa-cogs" aria-hidden="true"></i> Ações</th>
                        </tr>
                    </thead>
                    <tbody class="config-table-body">
                        {% for module in modules %}
                            <tr class="config-table-row{% if module.is_core %} config-table-row-core{% endif %}">
                                <td class="config-table-cell">
                                    <span class="config-module-name">{{ module.display_name }}</span>
                                    {% if module.is_core %}
                                        <span class="config-badge config-badge-core" title="Módulo essencial">
                                            <i class="fas fa-star" aria-hidden="true"></i> Core
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="config-table-cell">{{ module.description|default:'—' }}</td>
                                <td class="config-table-cell">
                                    {% if module.is_enabled %}
                                        <span class="config-badge config-badge-success">
                                            <i class="fas fa-check-circle" aria-hidden="true"></i> Ativo
                                        </span>
                                    {% else %}
                                        <span class="config-badge config-badge-secondary">
                                            <i class="fas fa-times-circle" aria-hidden="true"></i> Inativo
                                        </span>
                                    {% endif %}
                                </td>
                                <td class="config-table-cell">
                                    <div class="config-actions-group">
                                        <a href="{% url 'config:module_detail' module.app_name %}" class="config-btn config-btn-info config-btn-sm" title="Detalhes">
                                            <i class="fas fa-info-circle" aria-hidden="true"></i>
                                        </a>
                                        {% if not module.is_core %}
                                            {% if module.is_enabled %}
                                                <form method="post" action="{% url 'config:module_disable' module.app_name %}" class="config-form-inline">
                                                    {% csrf_token %}
                                                    <button type="submit" class="config-btn config-btn-warning config-btn-sm" title="Desativar">
                                                        <i class="fas fa-toggle-off" aria-hidden="true"></i>
                                                    </button>
                                                </form>
                                            {% else %}
                                                <form method="post" action="{% url 'config:module_enable' module.app_name %}" class="config-form-inline">
                                                    {% csrf_token %}
                                                    <button type="submit" class="config-btn config-btn-success config-btn-sm" title="Ativar">
                                                        <i class="fas fa-toggle-on" aria-hidden="true"></i>
                                                    </button>
                                                </form>
                                            {% endif %}
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                        {% empty %}
                            <tr class="config-table-row">
                                <td colspan="4" class="config-table-cell config-table-empty">
                                    Nenhum módulo encontrado.
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Layout responsivo para mobile -->
            <div class="config-mobile-cards">
                {% for module in modules %}
                <div class="config-mobile-card{% if module.is_core %} config-mobile-card-core{% endif %}">
                    <div class="config-mobile-header">
                        <span class="config-mobile-title">{{ module.display_name }}</span>
                        {% if module.is_core %}
                            <span class="config-badge config-badge-core" title="Módulo essencial">
                                <i class="fas fa-star" aria-hidden="true"></i> Core
                            </span>
                        {% endif %}
                    </div>
                    <div class="config-mobile-body">
                        <div class="config-mobile-field">
                            <span class="config-mobile-label">Descrição:</span>
                            <span class="config-mobile-value">{{ module.description|default:'—' }}</span>
                        </div>
                        <div class="config-mobile-field">
                            <span class="config-mobile-label">Status:</span>
                            {% if module.is_enabled %}
                                <span class="config-badge config-badge-success">
                                    <i class="fas fa-check-circle" aria-hidden="true"></i> Ativo
                                </span>
                            {% else %}
                                <span class="config-badge config-badge-secondary">
                                    <i class="fas fa-times-circle" aria-hidden="true"></i> Inativo
                                </span>
                            {% endif %}
                        </div>
                        <div class="config-mobile-actions">
                            <a href="{% url 'config:module_detail' module.app_name %}" class="config-btn config-btn-info config-btn-sm" title="Detalhes">
                                <i class="fas fa-info-circle" aria-hidden="true"></i> Detalhes
                            </a>
                            {% if not module.is_core %}
                                {% if module.is_enabled %}
                                    <form method="post" action="{% url 'config:module_disable' module.app_name %}" class="config-form-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="config-btn config-btn-warning config-btn-sm" title="Desativar" onclick="return confirm('Tem certeza que deseja desativar este módulo?')">
                                            <i class="fas fa-toggle-off" aria-hidden="true"></i> Desativar
                                        </button>
                                    </form>
                                {% else %}
                                    <form method="post" action="{% url 'config:module_enable' module.app_name %}" class="config-form-inline">
                                        {% csrf_token %}
                                        <button type="submit" class="config-btn config-btn-success config-btn-sm" title="Ativar">
                                            <i class="fas fa-toggle-on" aria-hidden="true"></i> Ativar
                                        </button>
                                    </form>
                                {% endif %}
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% empty %}
                <div class="config-mobile-empty">
                    Nenhum módulo encontrado.
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gerenciar botões de desativar módulo
    const disableButtons = document.querySelectorAll('button[title="Desativar"]');
    
    disableButtons.forEach(function(button) {
        button.addEventListener('click', function(event) {
            // Prevenir submissão imediata
            event.preventDefault();
            
            // Mostrar confirmação
            const confirmed = confirm('Tem certeza que deseja desativar este módulo?');
            
            if (confirmed) {
                // Se confirmado, submeter o formulário
                const form = button.closest('form');
                if (form) {
                    // Remover o listener temporariamente para evitar loop
                    button.removeEventListener('click', arguments.callee);
                    form.submit();
                }
            }
            // Se não confirmado, não faz nada (formulário não é submetido)
        });
    });
});
</script>
{% endblock %}
